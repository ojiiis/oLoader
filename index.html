const oLoader = () => {
    const head = document.head;
    const body = document.body;
    const queue = [];

    const loadFile = (file, target, type = "") => {
        queue.push(() => 
            fetch(file)
                .then((req) => {
                    if (!req.ok) throw new Error(`HTTP error! Status: ${req.status}`);
                    return req.text();
                })
                .then((res) => {
                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = res;
                    const scripts = tempDiv.getElementsByTagName("script");

                    if (type === "script") {
                        const newScript = document.createElement("script");
                        newScript.textContent = tempDiv.innerHTML.replace(/<script[\s\S]*?<\/script>/gi, "");
                        newScript.async = false;
                        target.appendChild(newScript);
                    } else {
                        target.insertAdjacentHTML("beforeend", tempDiv.innerHTML.replace(/<script[\s\S]*?<\/script>/gi, ""));
                    }

                    for (let script of scripts) {
                        const newScript = document.createElement("script");
                        if (script.src) {
                            newScript.src = script.src;
                            newScript.async = false;
                        } else {
                            newScript.textContent = script.textContent;
                        }
                        body.appendChild(newScript);
                    }
                })
                .catch((e) => console.error(`Error loading ${file}:`, e))
        );
    };

    const instance = {
        head(file) {
            loadFile(file, head);
            return instance;
        },
        body(file) {
            loadFile(file, body);
            return instance;
        },
        script(file) {
            loadFile(file, body, "script");
            return instance;
        },
        load(callback = null) {
            const executeQueue = async () => {
                for (const task of queue) {
                    await task();
                }
                if (typeof callback === "function") callback();
            };
            executeQueue();
        }
    };

    return instance;
};
