const App =  (id=null) => {
  
    const head = document.head;
    const body = document.body;

    const loadFile = async (file, target) => {
        try {
            const req = await fetch(file);
            if (!req.ok) throw new Error(`HTTP error! Status: ${req.status}`);
            const res = await req.text();

            // Create a temporary div to extract scripts
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = res;

            // Extract all <script> elements
            const scripts = tempDiv.getElementsByTagName("script");

            // Append non-script content first
            target.insertAdjacentHTML("beforeend", tempDiv.innerHTML.replace(/<script[\s\S]*?<\/script>/gi, ""));

            // Process scripts separately
            for (let script of scripts) {
                const newScript = document.createElement("script");
                if (script.src) {
                    newScript.src = script.src;
                    newScript.async = false; // Maintain execution order
                } else {
                    newScript.textContent = script.textContent;
                }
                body.appendChild(newScript);
            }
        } catch (e) {
            console.error(e);
        }
    };

    const instance = {
        async head(file) {
            await loadFile(file, head);
            return instance;
        },
        async body(file) {
            await loadFile(file, body);
            return instance;
        },
        async script(file) {
            await loadFile(file, body);
            return instance;
        },
        run(func) {
            if (typeof func === "function") {
                func();
            }
        }
    };

    return instance;
};
                
